#!/bin/bash
if [ -r dunit-progress-host1.txt ]; then
  dunitprog=dunit-progress-host1.txt
elif [ -r dunit-progress-host.txt ]; then
  dunitprog=dunit-progress-host.txt
else
  dunitprog=dunit-progress.txt
fi
if [ ! -r $dunitprog ]; then
  echo "redunit must be run in a dunit test directory containing dunit-progress.txt, dunit-progress-host.txt or dunit-progress-host1.txt"
  exit 2
fi
cat <<'STARTEND' >../dunit-tests.conf
// This file was generated by dunit.impl.DUnitConfigAntTask
// on Wed Mar 05 00:03:46 PST 2008

INCLUDE $JTESTS/dunit/impl/dunitN.inc;

hydra.GemFirePrms-logLevel = fine;

hydra.VmPrms-extraVMArgs = 
  "-ea"
  "-Xms125m"
  "-Xmx250m"
  "-Dgemfire.DEFAULT_MAX_OPLOG_SIZE=10"
  "-Dp2p.defaultConcurrencyLevel=6"
  "-DBridgeServer.SELECTOR=false"
  "-DBridgeServer.SELECTOR_POOL_SIZE=10"
  "-DDUNIT.MAX_PUTTERS=100"
  "-DDUNIT.MAX_PUT_OPS=50000"
  "-DDUNIT.PUT_SIZE=1"
  "-DDUNIT.PUT_TIMEOUT=10000"
  "-DBridgeServer.MAX_INCOMING_DATA=-1"
  "-DBridgeServer.MAX_INCOMING_MSGS=-1"
  "-Dgemfire.disable-event-old-value=false"
  "-Dgemfire.enable-time-statistics=true"
  "-Dgemfire.ack-wait-threshold=60"
  "-DJUnitTestSuite.maxRunSecs=1200"
  "-Dack-threshold-exception=false"
  "-Xdebug"
  "-Xrunjdwp:transport=dt_socket,suspend=n,server=y"
  "-DBridgeServer.handShakeTimeout=3000"
  "-Dgemfire.statsDisabled=false"
  "-DDistributionManager.DISCONNECT_WAIT=20000"
  "-Dgemfire.disallowMcastDefaults=true"
  "-Dgf.ldap.server=ldap.gemstone.com"
  "-Dgf.ldap.basedn=ou=ldapTesting,dc=pune,dc=gemstone,dc=com"
  "-DdunitLogPerTest=false"
  "-DdunitRecordResults=false"
  "-DdunitFromTestClass="
  "-DDistributionManager.VERBOSE=true"
  ;

STARTEND


echo "hydra.VmPrms-extraClassPaths=\"$build/cobertura.jar:$build/tests/classes:$build/product/lib/antlr.jar:$build/product/lib/gfsh.jar:$build/tests/lib/derby.jar:$build/product/lib/commons-logging.jar:$build/product/lib/commons-modeler-2.0.jar:$build/product/lib/mx4j.jar:$build/product/lib/mx4j-remote.jar:$build/product/lib/mx4j-tools.jar:$build/product/lib/mail.jar:$build/product/examples/dist/classes:/export/gcm/where/java/JavaConTest/Lib/ConTest.jar:/export/gcm/where/java/ant/apache-ant-1.8.2/lib/ant.jar:/export/gcm/where/java/ant/apache-ant-1.8.2/lib/ant-junit.jar:/export/gcm/where/java/jetty-6.1.3/postgresql-8.3-604.jdbc4.jar:$build\";" >>../dunit-tests.conf
#echo "hydra.VmPrms-extraClassPaths=\"$build/tests/classes:$build/product/lib/antlr.jar:$layer/tests/lib/derby.jar:$build/product/lib/commons-logging.jar:$build/product/lib/commons-modeler-2.0.jar:$build/product/lib/mx4j.jar:$build/product/lib/mx4j-remote.jar:$build/product/lib/mx4j-tools.jar:$build/product/lib/mail.jar:$build/product/examples/dist/classes:/gcm/where/java/JavaConTest/Lib/ConTest.jar:/gcm/where/java/ant/apache-ant-1.6.2/lib/ant.jar:/gcm/where/java/ant/apache-ant-1.6.2/lib/ant-junit.jar:/gcm/where/java/httpunit/lib/GroboTestingJUnit-1.1.0-core.jar:/gcm/where/java/httpunit/lib/Tidy.jar:/gcm/where/java/httpunit/lib/httpunit.jar:/gcm/where/java/httpunit/lib/js.jar:/gcm/where/java/httpunit/lib/junit.jar:/gcm/where/java/httpunit/lib/log4j-1.2.8.jar:/gcm/where/java/httpunit/lib/nekohtml.jar:/gcm/where/java/httpunit/lib/servlet.jar:/gcm/where/java/httpunit/lib/xercesImpl.jar:/gcm/where/java/httpunit/lib/xmlParserAPIs.jar\";" >>../dunit-tests.conf
echo "hydra.Prms-manageLocatorAgents=false;" >>../dunit-tests.conf
echo UNITTEST >>../dunit-tests.conf

failures=`ls failures`;
for x in $failures; do
  testClass=`basename $x .txt`
  echo "    testClass = $testClass" >>../dunit-tests.conf
done

echo "    ;" >>../dunit-tests.conf
cd ..
rm -f dunit-tests.bt
echo "$PWD/dunit-tests.conf dunitSites=1" >dunit-tests.bt
hydra@
